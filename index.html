<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strang OS - Synced</title>
    <style>
        @import url('https://fonts.cdnfonts.com/css/din-pro');

        body, html { 
            margin: 0; padding: 0; 
            width: 100%; height: 100%; 
            overflow: hidden; 
            background-color: #000; 
        }

        /* --- STAGE --- */
        #stage {
            position: absolute;
            top: 0; left: 0;
            width: 300vw; 
            height: 100vh;
        }

        /* --- SLIDE FRAMES --- */
        .slide-frame {
            position: absolute;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            transition: transform 1.5s cubic-bezier(0.77, 0, 0.175, 1); /* Fly Up Ease */
            will-change: transform;
        }

        /* POSITIONS */
        .pos-center { transform: translateY(0); z-index: 10; }
        .pos-bottom { transform: translateY(100vh); z-index: 5; } 
        .pos-top    { transform: translateY(-100vh); z-index: 5; } 

        /* --- UI LAYER --- */
        .ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 999;
            pointer-events: none;
            transition: color 1.0s ease; 
        }

        .text-white .corner-text { color: #ffffff; }
        .text-black .corner-text { color: #000000; }

        .corner-text {
            position: absolute;
            font-family: 'DIN Pro', sans-serif;
            font-weight: 500;
            font-size: 18px; 
            text-transform: uppercase;
            letter-spacing: 2px;
            display: none; 
        }

        .top-left { top: 30px; left: 30px; }
        .bottom-left { bottom: 30px; left: 30px; }
        .top-right { top: 30px; right: 30px; text-align: right; }
        .bottom-right { bottom: 30px; right: 30px; text-align: right; }
    </style>
</head>
<body>

    <div id="stage">
        <iframe id="frame-a" class="slide-frame pos-center"></iframe>
        <iframe id="frame-b" class="slide-frame pos-bottom"></iframe>
    </div>

    <div id="ui-container" class="ui-layer text-black">
        <div class="corner-text top-left" id="ui-brand">STRANG.DESIGN</div>
        <div class="corner-text bottom-left" id="ui-city">MIAMI</div>
        <div class="corner-text top-right" id="timer">00:00:00</div>
        <div class="corner-text bottom-right" id="weather">LOADING...</div>
    </div>

    <script>
        // --- 1. CONFIGURATION ---
        const urlParams = new URLSearchParams(window.location.search);
        const screenID = (urlParams.get('screen') || 'center').toLowerCase().trim();
        
        // DURATION: 2 Minutes (120,000 ms)
        // Every 2 minutes on the system clock, the slides will change.
        const ROTATION_SPEED = 120000; 

        // --- 2. PLAYLIST ---
        const PLAYLIST = [
            { 
                file: 'strang_logo.html', 
                uiColor: 'black' 
            },
            { 
                file: 'strang_photo.html', 
                uiColor: 'white' 
            }
        ];

        let currentIndex = -1; // Start invalid to force initial load
        let activeFrameId = 'frame-a';

        // --- 3. SYNC LOGIC (The Brains) ---
        function checkSync() {
            // Get absolute world time in milliseconds
            const now = Date.now();
            
            // Calculate how many "2-minute blocks" have passed since 1970
            const timeBlock = Math.floor(now / ROTATION_SPEED);
            
            // Modulo finds our place in the playlist (0, 1, 0, 1...)
            const targetIndex = timeBlock % PLAYLIST.length;

            // If the time says we should be on a different slide than we are...
            if (targetIndex !== currentIndex) {
                if (currentIndex === -1) {
                    // First Load: Just appear instantly, no animation
                    jumpToSlide(targetIndex);
                } else {
                    // Update: Fly Up Animation
                    transitionToSlide(targetIndex);
                }
            }
        }

        // --- 4. TRANSITION FUNCTIONS ---

        function jumpToSlide(index) {
            const content = PLAYLIST[index];
            const frame = document.getElementById(activeFrameId);
            
            frame.src = content.file;
            document.getElementById('ui-container').className = `ui-layer text-${content.uiColor}`;
            
            currentIndex = index;
        }

        function transitionToSlide(index) {
            const nextContent = PLAYLIST[index];

            // Identify frames
            const currentFrame = document.getElementById(activeFrameId);
            const nextFrameId = activeFrameId === 'frame-a' ? 'frame-b' : 'frame-a';
            const nextFrame = document.getElementById(nextFrameId);

            // 1. Prepare Next Frame below
            nextFrame.className = 'slide-frame pos-bottom';
            nextFrame.src = nextContent.file;

            // 2. Animate after brief delay for loading
            setTimeout(() => {
                currentFrame.className = 'slide-frame pos-top'; // Fly Up
                nextFrame.className = 'slide-frame pos-center'; // Fly In
                
                // Update UI Color
                document.getElementById('ui-container').className = `ui-layer text-${nextContent.uiColor}`;

                // Update State
                activeFrameId = nextFrameId;
                currentIndex = index;
            }, 500); 
        }

        // --- 5. STANDARD SETUP ---
        const stage = document.getElementById('stage');
        function updateLayout() {
            if (screenID === 'left')   stage.style.left = '0vw';
            if (screenID === 'center') stage.style.left = '-100vw'; 
            if (screenID === 'right')  stage.style.left = '-200vw'; 
        }

        function setupUI() {
            const brand = document.getElementById('ui-brand');
            const city = document.getElementById('ui-city');
            const timer = document.getElementById('timer');
            const weather = document.getElementById('weather');

            if (screenID === 'left') { brand.style.display = 'block'; city.style.display = 'block'; }
            if (screenID === 'right') { timer.style.display = 'block'; weather.style.display = 'block'; }
        }

        function updateTime() {
            const now = new Date();
            const estTime = new Intl.DateTimeFormat('en-US', {
                timeZone: 'America/New_York',
                hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit'
            }).format(now);
            document.getElementById('timer').innerText = estTime + ":" + Math.floor(now.getMilliseconds()/100);
            
            // Run the sync check constantly
            checkSync();
            
            requestAnimationFrame(updateTime);
        }

        async function fetchWeather() {
            try {
                const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=25.7617&longitude=-80.1918&current_weather=true&temperature_unit=fahrenheit');
                const data = await response.json();
                if (data.current_weather) {
                    document.getElementById('weather').innerText = `${Math.round(data.current_weather.temperature)}Â°F`;
                }
            } catch (e) {}
        }

        // --- INIT ---
        window.addEventListener('load', () => {
            updateLayout();
            setupUI();
            updateTime(); // This starts the sync loop
            fetchWeather();
        });
        window.addEventListener('resize', updateLayout);

    </script>
</body>
</html>
