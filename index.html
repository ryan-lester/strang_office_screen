<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Strang Office Display Controller</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #000; }
        iframe { width: 100vw; height: 100vh; border: none; display: block; }
    </style>
</head>
<body>

<iframe id="displayFrame" src=""></iframe>

<script>

    const playlist = [
        'strang_mega.html',       // Index 0: Collaboration (Mega Poster)
        'strang_isometric.html',  // Index 1
        'strang_sketches.html',   // Index 2
        'strang_topography.html'  // Index 3
    ];

    const urlParams = new URLSearchParams(window.location.search);
    const screenID = urlParams.get('screen') || 'center'; 

    // Debugging: Force a specific minute with &minute=X
    const debugMinute = urlParams.get('minute');

    function updateDisplay() {
        const now = new Date();
        
        // If &minute= is in the URL, use that. Otherwise use real time.
        const minute = debugMinute ? parseInt(debugMinute) : now.getMinutes();

        let nextPoster = "";

        // --- LOGIC: FLIP EVERY MINUTE ---
        
        // EVEN MINUTES (0, 2, 4...) -> MEGA POSTER
        if (minute % 2 === 0) {
            nextPoster = `${playlist[0]}?screen=${screenID}`;
        } 
        
        // ODD MINUTES (1, 3, 5...) -> INDIVIDUAL POSTERS
        else {
            let offset = 0;
            if (screenID === 'left') offset = 0;
            if (screenID === 'center') offset = 1;
            if (screenID === 'right') offset = 2;

            const numberOfPosters = playlist.length - 1; 
            
            // We use 'minute' so the individual art changes every time this mode activates
            const index = ((minute + offset) % numberOfPosters) + 1;
            
            nextPoster = playlist[index];
        }

        const iframe = document.getElementById('displayFrame');
        
        // Only reload if the URL has actually changed
        if (!iframe.src.includes(nextPoster)) {
            console.log(`[${screenID.toUpperCase()}] Minute: ${minute}. Switching to: ${nextPoster}`);
            iframe.src = nextPoster;
        }
    }

    function memoryPurgeCheck() {
        const now = new Date();
        // Hard refresh at 3:00 AM to clear memory
        if (now.getHours() === 3 && now.getMinutes() === 0 && now.getSeconds() < 10) {
            window.location.reload();
        }
    }

    updateDisplay();
    
    // CHANGED: Checks every 1 second (1000ms) to ensure perfect sync
    setInterval(updateDisplay, 1000);
    
    setInterval(memoryPurgeCheck, 60000);

</script>
</body>
</html>
