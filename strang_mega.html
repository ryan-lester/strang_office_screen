<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>STRANG Unified Field (Synced)</title>
    <style>
        @import url('https://fonts.cdnfonts.com/css/din-pro');
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;500&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: #e6e6e6;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* THE RIGID GRID (6480px x 3840px) */
        .mega-wrapper {
            width: 6480px; 
            height: 3840px;
            position: absolute;
            top: 0;
            left: 0;
            background: #fdfdfd; 
            transform-origin: 0 0;
        }

        /* LAYER 1: WEBGL CANVAS */
        #furCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
        }

        /* LAYER 2: UI OVERLAY */
        .ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 20;
            pointer-events: none;
        }

        .corner-text {
            position: absolute;
            font-family: "Roboto Mono", monospace;
            font-size: 42px;
            color: #222222;
            text-transform: uppercase;
            letter-spacing: 3px;
            font-weight: 500;
        }

        /* LEFT SCREEN */
        .top-left { top: 140px; left: 140px; }
        .bottom-left { bottom: 140px; left: 140px; }

        /* CENTER SCREEN */
        .center-logo-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .mega-logo {
            width: 32%; 
            filter: brightness(0) invert(0);
            mix-blend-mode: difference;
        }

        /* RIGHT SCREEN */
        .top-right { top: 140px; right: 140px; text-align: right; }
        .bottom-right { bottom: 140px; right: 140px; text-align: right; }

    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>

    <div class="mega-wrapper" id="megaWrapper">
        <canvas id="furCanvas"></canvas>
        
        <div class="ui-layer">
            <div class="corner-text top-left">STRANG.DESIGN</div>
            <div class="corner-text bottom-left">MIAMI</div>

            <div class="center-logo-container">
                <img class="mega-logo" src="assets/strang_logo.png" alt="STRANG">
            </div>

            <div class="corner-text top-right" id="timer">00:00:00:0</div>
            <div class="corner-text bottom-right" id="weather">LOADING...</div>
        </div>
    </div>

<script>
    // --- 1. DATA LOGIC ---
    const timerEl = document.getElementById('timer');
    const weatherEl = document.getElementById('weather');

    function updateTime() {
        const now = new Date();
        const estTime = new Intl.DateTimeFormat('en-US', {
            timeZone: 'America/New_York',
            hour12: false,
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        }).format(now);
        timerEl.innerText = estTime + ":" + Math.floor(now.getMilliseconds()/100);
        requestAnimationFrame(updateTime);
    }

    async function fetchWeather() {
        try {
            const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=25.7617&longitude=-80.1918&current_weather=true&temperature_unit=fahrenheit');
            const data = await response.json();
            if (data.current_weather) {
                weatherEl.innerText = `${Math.round(data.current_weather.temperature)}Â°F`;
            }
        } catch (e) { weatherEl.innerText = "OFFLINE"; }
    }

    // --- 2. WEBGL LOGIC (SYNCED) ---
    const DENSITY = 30;  
    const LENGTH = 200;  
    const COLOR = '#222222';
    
    // Total Canvas Dimensions
    const width = 6480;
    const height = 3840;

    let scene, camera, renderer, linesMesh, positions, fadeMesh;

    function initWebGL() {
        const canvas = document.getElementById('furCanvas');
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0xfdfdfd);

        camera = new THREE.OrthographicCamera(0, width, 0, height, 1, 1000);
        camera.position.z = 10;

        renderer = new THREE.WebGLRenderer({
            canvas: canvas,
            antialias: false,
            preserveDrawingBuffer: true
        });
        renderer.setSize(width, height);
        renderer.autoClear = false;

        const cols = Math.floor(width / DENSITY);
        const rows = Math.floor(height / DENSITY);
        const totalLines = cols * rows;

        const geometry = new THREE.BufferGeometry();
        positions = new Float32Array(totalLines * 2 * 3);

        let i = 0;
        for (let x = 0; x < width; x += DENSITY) {
            for (let y = 0; y < height; y += DENSITY) {
                positions[i] = x; positions[i+1] = y; positions[i+2] = 0;
                positions[i+3] = x; positions[i+4] = y; positions[i+5] = 0;
                i += 6;
            }
        }
        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

        const material = new THREE.LineBasicMaterial({ color: new THREE.Color(COLOR) });
        linesMesh = new THREE.LineSegments(geometry, material);
        scene.add(linesMesh);

        // FADE LAYER
        const fadeGeo = new THREE.PlaneGeometry(width, height);
        fadeGeo.translate(width/2, height/2, 0);
        const fadeMat = new THREE.MeshBasicMaterial({ color: 0xfdfdfd, transparent: true, opacity: 0.2 });
        fadeMesh = new THREE.Mesh(fadeGeo, fadeMat);
    }

    function animate() {
        requestAnimationFrame(animate);
        
        // --- THE SYNC FIX ---
        // Instead of counting up from 0, we use the actual system time.
        // All screens will return the exact same number here.
        const now = Date.now();
        const syncTime = now * 0.0003; 

        const posArray = linesMesh.geometry.attributes.position.array;
        const total = positions.length / 6;
        let pIndex = 0;

        for (let k = 0; k < total; k++) {
            const x = posArray[pIndex];
            const y = posArray[pIndex + 1];

            // Large, sweeping horizontal waves that span the full 6480px width
            const angle = (Math.cos(x * 0.0005 + syncTime) + Math.sin(y * 0.0015 + syncTime)) * Math.PI;

            posArray[pIndex + 3] = x + Math.cos(angle) * LENGTH;
            posArray[pIndex + 4] = y + Math.sin(angle) * LENGTH;
            pIndex += 6;
        }
        linesMesh.geometry.attributes.position.needsUpdate = true;
        renderer.render(fadeMesh, camera);
        renderer.render(scene, camera);
    }

    // --- 3. SCREEN SETUP ---
    function setupScreen() {
        const wrapper = document.getElementById('megaWrapper');
        const urlParams = new URLSearchParams(window.location.search);
        const screenID = urlParams.get('screen') || 'center'; 

        let shiftX = 0;
        if (screenID === 'left')   shiftX = 0;
        if (screenID === 'center') shiftX = -2160;
        if (screenID === 'right')  shiftX = -4320;

        const windowW = window.innerWidth;
        const windowH = window.innerHeight;
        // Target is ONE screen size (2160x3840)
        const scale = Math.min(windowW / 2160, windowH / 3840);
        
        const currentShift = shiftX * scale;
        wrapper.style.transform = `translate(${currentShift}px, 0px) scale(${scale})`;
    }

    window.addEventListener('load', () => {
        setupScreen();
        updateTime();
        fetchWeather();
        initWebGL();
        animate();
    });
    window.addEventListener('resize', setupScreen);

</script>
</body>
</html>
