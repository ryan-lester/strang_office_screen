<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strang Slideshow - Buffered</title>
    <style>
        @import url('https://fonts.cdnfonts.com/css/din-pro');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            width: 100%; 
            height: 100vh; 
            overflow: hidden;
            background: #000;
            font-family: 'DIN Pro', sans-serif;
        }

        /* --- LOADING SCREEN --- */
        #loader {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease-out;
        }

        #progress-text {
            color: #fff;
            font-size: 24px;
            letter-spacing: 2px;
            margin-bottom: 20px;
        }

        #progress-bar-bg {
            width: 300px;
            height: 2px;
            background: #333;
        }

        #progress-bar-fill {
            width: 0%;
            height: 100%;
            background: #fff;
            transition: width 0.1s linear;
        }

        /* --- SLIDESHOW --- */
        .slide {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: none; /* Instant Cut */
            z-index: 1;
            will-change: opacity;
        }

        .slide.active {
            opacity: 1;
            z-index: 2;
        }
    </style>
</head>
<body>

    <div id="loader">
        <div id="progress-text">LOADING 0%</div>
        <div id="progress-bar-bg">
            <div id="progress-bar-fill"></div>
        </div>
    </div>

    <img id="slot-1" class="slide" src="" alt="">
    <img id="slot-2" class="slide" src="" alt="">

    <script>
        // --- CONFIGURATION ---
        const path = '/soft_opening/'; 
        const slideDuration = 20000; // 20 Seconds per slide

        // Automatically generate the list from 1 to 38
        const slides = [];
        for (let i = 1; i <= 38; i++) {
            slides.push(`strang_slides-${i}.jpg`);
        }

        // --- PRELOAD LOGIC ---
        let loadedCount = 0;
        const totalImages = slides.length;
        const imageObjects = []; 

        function startPreloading() {
            for (let i = 0; i < totalImages; i++) {
                const img = new Image();
                img.src = path + slides[i];
                
                img.onload = () => { onImageLoaded(); };
                img.onerror = () => { 
                    console.error("Failed to load:", img.src);
                    onImageLoaded(); 
                }; 
                
                imageObjects[i] = img; // Keep in memory
            }
        }

        function onImageLoaded() {
            loadedCount++;
            const percent = Math.floor((loadedCount / totalImages) * 100);
            
            // Update UI
            document.getElementById('progress-text').innerText = `LOADING ${percent}%`;
            document.getElementById('progress-bar-fill').style.width = `${percent}%`;

            if (loadedCount >= totalImages) {
                // All done! Fade out loader and start show
                setTimeout(() => {
                    const loader = document.getElementById('loader');
                    loader.style.opacity = '0';
                    setTimeout(() => { loader.style.display = 'none'; }, 500);
                    
                    // START THE ENGINE
                    requestAnimationFrame(updateSlide);
                }, 500);
            }
        }

        // --- PLAYBACK LOGIC ---
        let currentIndex = -1; 
        let activeSlot = 1;
        const img1 = document.getElementById('slot-1');
        const img2 = document.getElementById('slot-2');

        function getSyncedIndex() {
            const now = Date.now();
            const globalTick = Math.floor(now / slideDuration);
            return globalTick % slides.length;
        }

        function updateSlide() {
            const targetIndex = getSyncedIndex();

            if (targetIndex !== currentIndex) {
                // We use the preloaded source from memory
                const nextImageSrc = imageObjects[targetIndex].src;
                
                const currentImg = activeSlot === 1 ? img1 : img2;
                const nextImg = activeSlot === 1 ? img2 : img1;

                nextImg.src = nextImageSrc;
                nextImg.classList.add('active');
                currentImg.classList.remove('active');

                activeSlot = activeSlot === 1 ? 2 : 1;
                currentIndex = targetIndex;
            }

            requestAnimationFrame(updateSlide);
        }

        // Init
        startPreloading();

    </script>
</body>
</html>
